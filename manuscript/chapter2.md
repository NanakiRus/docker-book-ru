# Глава 2. Выполнение PHP-скрипта в Docker

Прежде чем мы начнём создавать наше приложение, полезно получить представление о том, как работает Docker, просто выполняя PHP-скрипт в Docker. Давайте начнём с написания классического скрипта «Привет, мир!» в PHP:

{title="hello.php", linenos=off, lang=php}
~~~~~~~
<?php
echo 'Привет, мир!';
~~~~~~~

Вы можете запустить этот скрипт в виртуальной машине или на своём ноутбуке (если у вас установлен PHP), запустив `php hello.php` из вашего терминала. Вы должны увидеть вывод `Привет, мир!` как мы напечатали его выше.

## Введение в образы Docker

Docker запускает каждый процесс внутри контейнера. Все эти контейнеры запускаются на «хост-машине», которая будет вашим компьютером в этой книге. Когда ваше приложение будет готово к продакшен-среде, сервер (или несколько серверов) будет выступать в качестве вашего хоста Docker.

За каждым запущенным контейнером находится «образ» (image). Образы Docker создаются и поддерживаются разработчиками программного обеспечения, используя файлы `Dockerfile`. Другими словами, если вы хотите создать свой образ Docker с нуля, сначала создайте новый файл `Dockerfile`, затем *собрать (build)* образ из него, а затем *запустить (run)* контейнер из образа.

{width=100%}
![Диаграмма 2: файлы Dockerfile, образы, контейнеры](images/diagram2.png)

К счастью для нас, нам обычно не нужно создавать собственные образы с нуля. Самые популярные программные платформы (включая PHP) имеют образы, которые официально предоставляются разработчиками программного обеспечения или группами заинтересованных пользователей. Вам редко нужно будет создавать совершенно новый образ, но позже мы увидим, как расширить существующий образ, написав свой собственный файл `Dockerfile`.

Docker-образы могут быть созданы и сохранены на вашем хост-машине, или они могут жить в удалённом «реестре». Помимо поддержки базовой платформы Docker, команда Docker поддерживает большой реестр [Docker Hub](https://hub.docker.com/), где общедоступные образы могут храниться бесплатно. Большинство команд разработчиков с открытым исходным кодом размещают официальные образы на Docker Hub, включая [PHP](https://hub.docker.com/_/php/).

## Получение Docker-образа PHP

Чтобы запустить наш скрипт `hello.php` в контейнере, нам сначала нужно «получить (pull)» образ PHP. Начнём с последней стабильной версии PHP. В вашем терминале запустите:

{linenos=off, lang=sh}
~~~~~~~
$ docker pull php:latest
~~~~~~~

Вы должны увидеть что-то подобное в своём терминале:

{linenos=off, lang=sh}
~~~~~~~
latest: Pulling from library/php
94ed0c431eb5: Pull complete
8d5410041793: Downloading   41.6MB/82.75MB
6ab2a160fa31: Download complete
247a60c07518: Download complete
b09bee244a51: Download complete
b808e084c9be: Downloading  7.222MB/9.858MB
1d362d99e847: Waiting
~~~~~~~

Это указывает на то, что Docker получает последнюю версию PHP-образа. Когда это будет сделано, Docker сообщит, что он получил последнюю версию, показывая вам такой статус:

{linenos=off, lang=sh}
~~~~~~~
Status: Downloaded newer image for php:latest
~~~~~~~

I> Примечание
I> Тег "latest" — стандартное соглашение, которое большинство Docker-образов используют для самой последней версии своего программного обеспечения. Остерегайтесь использовать "latest" беспорядочно, поскольку он автоматически отслеживает «последнюю» версию, даже если происходит изменение основной (major) версии.

Поскольку наш скрипт `hello.php` прост, не имеет значения, какую версию PHP мы используем, но что, если нам нужно запустить более старую версию PHP для существующего проекта? Именно здесь Docker действительно блистает, поскольку нам просто нужно указать версию PHP при выполнении команды `docker pull`. Например, чтобы загрузить образ с PHP 5.6, мы просто выполняем в консоли:

{linenos=off, lang=sh}
~~~~~~~
$ docker pull php:5.6
~~~~~~~

Мы можем использовать этот метод для получения более новых и невыпущенных версий PHP (при условии, что в списке [список реестров PHP](https://hub.docker.com/_/php/) есть по крайней мере бета-версия). Это делает выполнение PHP в Docker очень полезным для разработчиков, которым необходимо постоянно работать с несколькими версиями PHP.

## Получение кода в контейнер

Чтобы понять следующий шаг, вам нужно немного узнать о том, как Docker обращается к файлам на хост-машине. Выполняющийся контейнер не может просто спуститься и прочитать или записать файлы на ваш компьютер, поскольку этот контейнер фактически является собственной изолированной системой. Вместо этого мы должны запускать контейнеры с данными из хост-системы, примонтированные в [том (volume)](https://docs.docker.com/engine/admin/volumes/volumes/) или добавлять код при создании образа.

Позже в этой книге мы рассмотрим создание Docker-образов из файлов `Dockerfile` и добавление кода таким образом, но для этого простого примера «Привет, мир!», мы просто примонтируем файл `hello.php` в наш контейнер PHP с использованием тома.

## Запуск нашего скрипта «Привет, мир!» в Docker

Теперь, когда мы получили пару образов PHP из Docker Hub, и мы знаем немного о том, как Docker использует тома, мы можем запустить наш скрипт в контейнере в терминале:

{linenos=off, lang=sh}
~~~~~~~
$ docker run --rm -v $(pwd):/app php:latest php /app/hello.php
~~~~~~~

Если все было сделано правильно, вы должны увидеть `Hello World!` в командной строке. Вы только что запустили свой первый PHP-скрипт в Docker!

### Что здесь происходит?

Давайте обсудить эту Docker-команду и что она значит:

* `docker run` — Это команда Docker для [запуска команды в новом контейнере](https://docs.docker.com/engine/reference/run/). Есть много опций, которые вы можете передать, но мы только начинаем с основ.

* `--rm` — Это указывает Docker «удалить» контейнер после запуска команды. В качестве альтернативы вы можете сохранить контейнер, чтобы запустить его снова, но если вы в конце концов не удалите контейнер, он просто будет находится в простое, занимая место, поэтому лучше всего установить флаг удаления в большинстве случаев.

* `-v $(pwd):/app` — Это указывает Docker о [монтировании тома](https://docs.docker.com/engine/tutorials/dockervolumes/). Обычно вы передаёте путь к каталогу на вашей хост-машине, двоеточие, а затем путь к папке в контейнере. Объёмы — это мощный инструмент, но для этого простого примера мы просто монтируем текущий каталог (используя `$(pwd)`) из нашего терминала в каталог `/app` в новом контейнере Docker.

* `php:latest` — Это указывает на образ, который мы используем для этого контейнера. Вы можете указать другой образ PHP (например: `php:7.0` или `php:5.6`) для использования определённой версии языка.

* `php /app/hello.php` — Наконец, это команда, которую Docker будет запускать в контейнере. Поскольку мы примонтировали наш код в каталог `/app` на контейнере, нам нужно запустить наш скрипт из этого каталога.

Теперь, когда у вас есть базовое представление о Docker и вы можете запустить PHP-скрипт внутри контейнеров, пришло время создать что-то более полезное и интересное. Это также может быть подходящим временем, чтобы сделать перерыв и прочитать некоторые основные концепции Docker [в документации по нему](https://docs.docker.com/). Когда вы будете готовы, продолжайте чтение дальше для создания веб-приложение на PHP в Docker.